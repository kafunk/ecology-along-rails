<svg width="270.5" height="497">

  <g transform="translate(183.25,248.5)">

    <path class="map-road" d="M10.07462397817732,-143.1218081235826L8.779467374011938,-143.1691645997791L7.486171092460985,-143.2461188735984L6.167574423353802,-141.99709181391597L6.813478435083506,-140.02883827199935L6.807153338194446,-138.71765583730905L6.788550112050159,-137.42127230143015L6.781108821592443,-133.51140323545744L6.126275261313482,-130.28820307433384L6.769946885905868,-129.61337328853384L6.1322282936796535,-127.68655666328915L6.142274035797567,-125.0849102522445L6.147855003640855,-123.77076803779191L6.795247273462103,-123.0988980317542L6.14115784222891,-122.46846494238844L5.510508475937524,-120.53868853738146L4.868325109436678,-118.62075125142361L5.5417618958599295,-115.31171747719388L4.905159497202367,-113.39082041147377L4.9200420781178,-112.07075863749661L4.93752911069343,-110.78029466114225L5.6091055745022524,-108.7883628811274L5.627708800646544,-107.46830110715024L5.0204994992969585,-104.2214227079284L4.418499101267776,-100.97158452894428L4.470588134471782,-98.35513921908822L3.8648670912137417,-96.41352369503211L3.879005543083402,-95.1023412603418L3.9236532858296957,-93.79411860541376L3.9400241248366696,-92.48293617072345L3.9712775447590714,-91.15695483722173L4.6841531706082185,-89.17390239649372L4.038621223401399,-88.53754974760338L3.392717211671695,-87.89823731895078L1.4360298858154041,-87.32699982483061L0.7901258740857002,-86.69064717594028L-1.8347893348734394,-86.80015902714466L-2.481809540171804,-86.16084659849206L-3.077856905834815,-84.2133115149114L-5.037892812397076,-83.6450338005535L-6.962582589285185,-81.75077475269393L-9.557732636413464,-80.53726505015885L-11.536371769120013,-79.96306777627643L-12.168509393502946,-79.34151402619749L-16.100115206836925,-78.1960792581949L-16.748251605703945,-77.55972660930458L-19.349354685198396,-76.35509624605635L-21.966456539176935,-75.16822456138182L-23.922027671464566,-74.60290662678622L-23.248590885041313,-73.91327794217483L-23.209152045615422,-72.575457489624L-22.534599065623514,-71.88878858477489L-20.52284619038013,-71.13404474539333L-19.804761661210584,-69.10955538799338L-19.114209906734583,-68.40808758433288L-19.022309969581798,-65.762044476854L-20.298491283080004,-64.50117829812245L-20.25086702415063,-63.16335784557161L-19.5714772053612,-62.47668894072252L-18.841486611459313,-60.44923980356029L-18.09326485593602,-58.439549344971745L-17.35769329419084,-56.415059987571794L-15.976961849761734,-55.02988305882447L-15.236553449219043,-53.005393701424524L-13.152247992012933,-50.92466852854125L-13.077090958390006,-49.60164697480181L-13.030210828506398,-48.275665641300094L-11.640921900050916,-46.89344849231503L-11.44596009005877,-42.90070559299847L-10.755780400105659,-42.21995624767393L-9.997140837941563,-40.195466890274L-10.549284589904053,-38.221293788832824L-10.478592330555756,-36.877553776757416L-10.968973371719207,-33.57443956205225L-10.273584778445695,-32.893690216727705L-10.183545163907338,-31.564749103463704L-10.122154517631184,-30.232848210437425L-9.347516180983002,-28.208358853037474L-9.887009739167375,-26.22826619207174L-9.821154318616593,-24.89932507880774L-9.724789607189177,-23.56742418578146L-9.657073864023966,-22.23552329275518L-8.225369579959505,-20.844426804483295L-8.155049385134093,-19.512525911457015L-7.35064588665505,-17.50283545286847L-6.632561357485503,-16.807287208732518L-7.1887978191997375,-14.824234768004503L-6.469225031938649,-14.128686523868552L-5.657380243001888,-12.118996065280008L-4.229396604166285,-10.74565825558181L-3.4279696218703264,-8.72116889818186L-1.9962653378058655,-7.350790868245926L-1.2725998407930363,-6.658202403872273L-0.5634448601727475,-5.9833726180722895L-1.189629452189508,-5.326301510845993L-0.36513446947463224,-3.316611052257448L-0.9909469969685044,-2.659539945031151L-0.8748628658281408,-1.3276390520048709L-0.06004156070829455,0.6968503053950792L-0.5801877637026094,2.673983186598532L-0.47526556824882027,4.023642758198498L0.25472502565306854,4.716231222572168L0.46977831988104984,7.385952568149274L1.296505689733239,9.410441925549241L2.1258375112456296,11.437891062711438L3.578749473114579,12.79938975336053L3.6926012171176295,14.122411307099966L5.148489695169665,15.483909997749057L6.001633646146745,17.52023847419813L5.501578927388262,19.50625069468843L5.621383703757484,20.855910266288394L6.4667142997539635,22.883359403450626L5.863969772679009,23.531551171390078L5.971868484315884,24.86937162394092L5.604640800227622,28.210962975555745L5.731514802531672,29.563582326917995L5.129886469025374,30.21473387461973L4.8865562710580805,34.90006523830993L3.803848509460474,37.57570614341161L3.9370476086535837,38.93128527453614L3.337651662284599,39.582436822237874L2.843177911369403,41.595087060588696L2.243781965000422,42.24623860829043L1.1677713648147598,44.9248392931544L-0.05929743166252207,46.26265974570524L-1.1475861611034155,48.92942131152008L-2.2176437289229023,51.61098177614633L-2.8159234817232264,52.26509310361035L-4.184376796897107,52.2414148655121L-4.797911195135748,52.91032509178752L-3.3010956195662766,54.280703121723455L-1.6420599120186072,56.99482116373479L-2.1220231465412587,59.01339096161018L-0.6185104095598436,60.3808092117838L1.204233688057565,64.45642594444423L1.3422696260481894,65.80608551604419L2.1050018979640295,66.49571420065558L2.8524795244415486,67.17054398645557L3.0228850759232313,68.51724377829325L4.536443555022564,69.87874246894235L5.445025119909626,71.91507094539138L5.589758219312193,73.26473051699135L6.356583200979776,73.95139942184046L8.053197425338908,76.65663812456495L8.806256019659713,77.32850813060266L8.202395299016102,78.00629769616492L8.36796401170027,79.367796386814L8.533160659861554,80.70265705960257L9.456624805664047,82.73602575628934L10.383065467649628,84.77235423273841L10.569097729092515,86.11905402457609L12.274641502000904,88.839091626112L12.433885117796017,90.18875119771197L11.847883494250924,90.8547016442251L12.785486091923072,92.8880703409119L12.186090145554092,93.56881968623644L11.779795686562824,95.59922860316092L11.943876141155451,96.95184795452316L11.3593627757019,97.61779840103631L10.942278445546949,99.66596599653451L10.525566179914877,101.6845357944099L9.528433258581002,104.40161361618351L9.71297726193235,105.73943406873435L9.302962157712223,107.79352122375708L8.296527623306204,110.49875992648158L7.9047436807074805,112.53508840293065L8.692404275656667,113.22175730777975L8.096356909993656,113.90546643286659L8.28722601023406,115.24624666517971L8.481071626657549,116.6166246951156L8.457259497192858,121.37299077310058L8.670080404283523,122.72856990422511L9.054050991901642,125.45748684504785L8.475118594291377,126.12935685108552L8.864298085229896,128.86123357167054L8.286109816665403,129.53310357770826L7.101084311274209,130.90644138740646L7.882419809334336,131.58127117320646L6.919144759583067,134.31314789379147L7.718339354741708,134.99981679864055L8.13467955585089,137.71985440017644L8.328897236797268,139.08135309082553L8.554740402188932,140.43989200171237L8.751562534795505,141.80139069236145L9.17832054254549,144.52142829389732L8.589342402817307,145.214016758271L7.425524575230606,146.57847522868235L7.642810256595896,147.95477281814286L7.844469227999985,149.31923128855422L8.078125748372253,150.6807299792033L8.282017106913656,152.04222866985236L9.090513315144447,152.72889757470148"></path>

    <path class="map-road map-road--story" d="M10.07462397817732,-143.1218081235826L8.779467374011938,-143.1691645997791L7.486171092460985,-143.2461188735984L6.167574423353802,-141.99709181391597L6.813478435083506,-140.02883827199935L6.807153338194446,-138.71765583730905L6.788550112050159,-137.42127230143015L6.781108821592443,-133.51140323545744L6.126275261313482,-130.28820307433384L6.769946885905868,-129.61337328853384L6.1322282936796535,-127.68655666328915L6.142274035797567,-125.0849102522445L6.147855003640855,-123.77076803779191L6.795247273462103,-123.0988980317542L6.14115784222891,-122.46846494238844L5.510508475937524,-120.53868853738146L4.868325109436678,-118.62075125142361L5.5417618958599295,-115.31171747719388L4.905159497202367,-113.39082041147377L4.9200420781178,-112.07075863749661L4.93752911069343,-110.78029466114225L5.6091055745022524,-108.7883628811274L5.627708800646544,-107.46830110715024L5.0204994992969585,-104.2214227079284L4.418499101267776,-100.97158452894428L4.470588134471782,-98.35513921908822L3.8648670912137417,-96.41352369503211L3.879005543083402,-95.1023412603418L3.9236532858296957,-93.79411860541376L3.9400241248366696,-92.48293617072345L3.9712775447590714,-91.15695483722173L4.6841531706082185,-89.17390239649372L4.038621223401399,-88.53754974760338L3.392717211671695,-87.89823731895078L1.4360298858154041,-87.32699982483061L0.7901258740857002,-86.69064717594028L-1.8347893348734394,-86.80015902714466L-2.481809540171804,-86.16084659849206L-3.077856905834815,-84.2133115149114L-5.037892812397076,-83.6450338005535L-6.962582589285185,-81.75077475269393L-9.557732636413464,-80.53726505015885L-11.536371769120013,-79.96306777627643L-12.168509393502946,-79.34151402619749L-16.100115206836925,-78.1960792581949L-16.748251605703945,-77.55972660930458L-19.349354685198396,-76.35509624605635L-21.966456539176935,-75.16822456138182L-23.922027671464566,-74.60290662678622L-23.248590885041313,-73.91327794217483L-23.209152045615422,-72.575457489624L-22.534599065623514,-71.88878858477489L-20.52284619038013,-71.13404474539333L-19.804761661210584,-69.10955538799338L-19.114209906734583,-68.40808758433288L-19.022309969581798,-65.762044476854L-20.298491283080004,-64.50117829812245L-20.25086702415063,-63.16335784557161L-19.5714772053612,-62.47668894072252L-18.841486611459313,-60.44923980356029L-18.09326485593602,-58.439549344971745L-17.35769329419084,-56.415059987571794L-15.976961849761734,-55.02988305882447L-15.236553449219043,-53.005393701424524L-13.152247992012933,-50.92466852854125L-13.077090958390006,-49.60164697480181L-13.030210828506398,-48.275665641300094L-11.640921900050916,-46.89344849231503L-11.44596009005877,-42.90070559299847L-10.755780400105659,-42.21995624767393L-9.997140837941563,-40.195466890274L-10.549284589904053,-38.221293788832824L-10.478592330555756,-36.877553776757416L-10.968973371719207,-33.57443956205225L-10.273584778445695,-32.893690216727705L-10.183545163907338,-31.564749103463704L-10.122154517631184,-30.232848210437425L-9.347516180983002,-28.208358853037474L-9.887009739167375,-26.22826619207174L-9.821154318616593,-24.89932507880774L-9.724789607189177,-23.56742418578146L-9.657073864023966,-22.23552329275518L-8.225369579959505,-20.844426804483295L-8.155049385134093,-19.512525911457015L-7.35064588665505,-17.50283545286847L-6.632561357485503,-16.807287208732518L-7.1887978191997375,-14.824234768004503L-6.469225031938649,-14.128686523868552L-5.657380243001888,-12.118996065280008L-4.229396604166285,-10.74565825558181L-3.4279696218703264,-8.72116889818186L-1.9962653378058655,-7.350790868245926L-1.2725998407930363,-6.658202403872273L-0.5634448601727475,-5.9833726180722895L-1.189629452189508,-5.326301510845993L-0.36513446947463224,-3.316611052257448L-0.9909469969685044,-2.659539945031151L-0.8748628658281408,-1.3276390520048709L-0.06004156070829455,0.6968503053950792L-0.5801877637026094,2.673983186598532L-0.47526556824882027,4.023642758198498L0.25472502565306854,4.716231222572168L0.46977831988104984,7.385952568149274L1.296505689733239,9.410441925549241L2.1258375112456296,11.437891062711438L3.578749473114579,12.79938975336053L3.6926012171176295,14.122411307099966L5.148489695169665,15.483909997749057L6.001633646146745,17.52023847419813L5.501578927388262,19.50625069468843L5.621383703757484,20.855910266288394L6.4667142997539635,22.883359403450626L5.863969772679009,23.531551171390078L5.971868484315884,24.86937162394092L5.604640800227622,28.210962975555745L5.731514802531672,29.563582326917995L5.129886469025374,30.21473387461973L4.8865562710580805,34.90006523830993L3.803848509460474,37.57570614341161L3.9370476086535837,38.93128527453614L3.337651662284599,39.582436822237874L2.843177911369403,41.595087060588696L2.243781965000422,42.24623860829043L1.1677713648147598,44.9248392931544L-0.05929743166252207,46.26265974570524L-1.1475861611034155,48.92942131152008L-2.2176437289229023,51.61098177614633L-2.8159234817232264,52.26509310361035L-4.184376796897107,52.2414148655121L-4.797911195135748,52.91032509178752L-3.3010956195662766,54.280703121723455L-1.6420599120186072,56.99482116373479L-2.1220231465412587,59.01339096161018L-0.6185104095598436,60.3808092117838L1.204233688057565,64.45642594444423L1.3422696260481894,65.80608551604419L2.1050018979640295,66.49571420065558L2.8524795244415486,67.17054398645557L3.0228850759232313,68.51724377829325L4.536443555022564,69.87874246894235L5.445025119909626,71.91507094539138L5.589758219312193,73.26473051699135L6.356583200979776,73.95139942184046L8.053197425338908,76.65663812456495L8.806256019659713,77.32850813060266L8.202395299016102,78.00629769616492L8.36796401170027,79.367796386814L8.533160659861554,80.70265705960257L9.456624805664047,82.73602575628934L10.383065467649628,84.77235423273841L10.569097729092515,86.11905402457609L12.274641502000904,88.839091626112L12.433885117796017,90.18875119771197L11.847883494250924,90.8547016442251L12.785486091923072,92.8880703409119L12.186090145554092,93.56881968623644L11.779795686562824,95.59922860316092L11.943876141155451,96.95184795452316L11.3593627757019,97.61779840103631L10.942278445546949,99.66596599653451L10.525566179914877,101.6845357944099L9.528433258581002,104.40161361618351L9.71297726193235,105.73943406873435L9.302962157712223,107.79352122375708L8.296527623306204,110.49875992648158L7.9047436807074805,112.53508840293065L8.692404275656667,113.22175730777975L8.096356909993656,113.90546643286659L8.28722601023406,115.24624666517971L8.481071626657549,116.6166246951156L8.457259497192858,121.37299077310058L8.670080404283523,122.72856990422511L9.054050991901642,125.45748684504785L8.475118594291377,126.12935685108552L8.864298085229896,128.86123357167054L8.286109816665403,129.53310357770826L7.101084311274209,130.90644138740646L7.882419809334336,131.58127117320646L6.919144759583067,134.31314789379147L7.718339354741708,134.99981679864055L8.13467955585089,137.71985440017644L8.328897236797268,139.08135309082553L8.554740402188932,140.43989200171237L8.751562534795505,141.80139069236145L9.17832054254549,144.52142829389732L8.589342402817307,145.214016758271L7.425524575230606,146.57847522868235L7.642810256595896,147.95477281814286L7.844469227999985,149.31923128855422L8.078125748372253,150.6807299792033L8.282017106913656,152.04222866985236L9.090513315144447,152.72889757470148" style="stroke-dasharray: 347.261, 349.141;"></path>

    <g class="map-label map-label--road">

      <g transform="translate(10.07462397817732,-143.1218081235826)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">St. Petersburg</text>
      </g>
      <g transform="translate(5.554412089638045,-104.48484310677138)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Lyuban</text>
      </g>
      <g transform="translate(4.817352269801324,-87.90119709871306)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Chudovo</text>
      </g>
      <g transform="translate(-24.420594132131505,-73.9339964005108)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Veliky Novgorod</text>
      </g>
      <g transform="translate(-6.602424131131756,-15.395472262124667)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Valdai</text>
      </g>
      <g transform="translate(0.17882386298437244,32.67135107731265)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Pochinok</text>
      </g>
      <g transform="translate(-4.7822844851745465,52.546272181027014)" class="map-label--visited">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Torzhok</text>
      </g>
      <g transform="translate(8.895923569675185,138.0898268704615)" class="map-label--visited map-label--visiting">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Chernaya Gryaz</text>
      </g>
      <g transform="translate(9.090513315144447,152.72889757470148)" class="">
        <circle r="2.5"></circle>
        <text dy=".35em" x="-10">Moscow</text>
      </g>

    </g>

  </g>

</svg>



<script>

  if (!/iPad|iPod|iPhone/.test(navigator.userAgent)) defer(function() {

  var width,
      height,
      nativeHeight = 1000,
      scale,
      y0,
      y1;

  var y = d3.scale.linear()
      .range([0, .125, .171, .267, .455, .613, .680, .955, 1]);

  var resizeTimeout,
      render = function() {};

  var path = d3.geo.path()
      .projection(d3.geo.transform({point: function(x, y) { this.stream.point(x * scale, y * scale); }}));

  var section = d3.select(".map-left");

  var svg = section.append("svg");

  var g = svg.append("g");

  var marker = d3.selectAll([]);

  var article = d3.select(".article");

  d3.select(window)
      .on("resize.map-left", resized)
      .on("load.map-left", resized)
      .call(resized);

  function resized() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(afterresized, 10);
  }

  function afterresized() {
    width = document.body.clientWidth / 4;
    height = innerHeight;
    scale = (height - 200) / nativeHeight;
    y0 = article.node().offsetTop;
    y1 = y0 + article.node().offsetHeight - innerHeight;

    svg
        .attr("width", width)
        .attr("height", height);

    g
        .attr("transform", "translate(" + (width / 2 + 48) + "," + height / 2 + ")");

    y
        .domain(marker
          .each(function(d) { d.properties.position = this.offsetTop; })
          .data().map(function(d) { return d.properties.position; }));

    render();
  }

  d3.json("http://graphics8.nytimes.com/newsgraphics/2013/10/13/russia/207ffeebeb08f93156b7a4be9b0c17863de3143a/map-left.json", function(error, topo) {
    var road = topojson.feature(topo, topo.objects.road),
        roadLength = length(road.geometry.coordinates),
        cities = topojson.feature(topo, topo.objects.cities).features;

    marker = d3.selectAll(".map-marker")
        .data(cities, function(d) { return d ? d.properties.name : this.getAttribute("data-key"); })
        .each(function(d, i) { d.properties.position = this.offsetTop; d.properties.top = y.range()[i]; });

    y.domain(cities.map(function(d) { return d.properties.position; }));

    g.append("path")
        .datum(road)
        .attr("class", "map-road");

    var feature = g.append("path")
        .datum(road)
        .attr("class", "map-road map-road--story");

    var label = g.append("g")
        .attr("class", "map-label map-label--road")
      .selectAll("g")
        .data(cities)
      .enter().append("g")
        .on("click", clicked);

    label.append("circle")
        .attr("r", 2.5);

    label.append("text")
        .attr("dy", ".35em")
        .attr("x", -10)
        .text(function(d) { return d.properties.name; });

    render = function() {
      g.selectAll("path").attr("d", path);
      label.attr("transform", function(d) { d = d.geometry.coordinates; return "translate(" + d[0] * scale + "," + d[1] * scale + ")"; });
      scrolled();
    };

    d3.select(window)
        .on("scroll.map-left", scrolled)
        .call(render);

    function scrolled() {
      var top = y(pageYOffset), maxTop = 0;

      section
          .style("top", pageYOffset > y1 ? y1 - pageYOffset + "px" : pageYOffset < y0 ? y0 - pageYOffset + "px" : null);

      feature
          .style("stroke-dasharray", top * roadLength * scale + "," + roadLength * scale);

      label
          .classed("map-label--visited", function(d) { var t = d.properties.top; if (t < top) { if (t > maxTop) maxTop = t; return true; }})
          .classed("map-label--visiting", function(d) { return d.properties.top === maxTop; });
    }

    function clicked(d, i) {
      d3.transition()
          .duration(750)
          .tween("scroll", function() {
            var offset = d3.interpolateNumber(pageYOffset, d.properties.position + (i ? 40 : 0));
            return function(t) { scrollTo(0, offset(t)); };
          });
    }
  });

  function length(line) {
    var i = 0,
        n = line.length,
        p0,
        p1 = line[0],
        length = 0,
        dx,
        dy;

    while (++i < n) {
      p0 = p1;
      p1 = line[i];
      dx = p1[0] - p0[0];
      dy = p1[1] - p0[1];
      length += Math.sqrt(dx * dx + dy * dy);
    }

    return length;
  }

  });
</script>
